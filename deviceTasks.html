<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
  </head>
  <body>

    <output id="list"></output>
    
    <script>
      function showListDevices(devices){
      var output = [];
       for (var i = 0, d;  d = devices[i]; i++) {
      output.push('<li><strong>', d, '</strong>',' <button type="button" name="btn" onclick="callDeviceTasks(this);">Tasks</button>',
        '</li>');
      }
      document.getElementById('list').innerHTML = '<ul>' + output.join('') + '</ul>';
      }
      function getListDevices() {
      var devices = [];
      var conn = new XMLHttpRequest();
      conn.open("GET", 'http://localhost:8080/dev');
      conn.onreadystatechange = function(){
      if(conn.readyState==4){
           devices = JSON.parse(conn.responseText);
           console.log(devices);
           showListDevices(devices);
         }
    };
    conn.send();
    }
    window.onload = getListDevices;

      function callDeviceTasks(node){
      var device = node.parentNode.childNodes[0].innerHTML;
      alert(device);
      localStorage.setItem("device",device);
       window.location="deviceTasks.html";
     }
    </script>




    
    <p>Duration(s): <input type="number" id="duration"></p>
    <p>Frequency(ms): <input type="number" id="frequency"></p>
    <button type="button" onclick="myFunction()">New Task</button>
    <script>
	function myFunction() {
	var device  =  localStorage.getItem("device");
	alert(device);
	var duration = document.getElementById("duration");
	var frequency  = document.getElementById("frequency");
	var data = new FormData();
	data.append('device_name', device.value);
	data.append('duration_seconds', duration.value);
	data.append('frequency_milliseconds', frequency.value);

	var xhr = new XMLHttpRequest();
	xhr.open('POST','http://localhost:8080/taskAgenda' , true);
	xhr.onload = function () {
	// do something to response
	console.log(this.responseText);
	};
	xhr.send(data);
	window.location="results.html";
	}
      </script>
  </body>
</html>
